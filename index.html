<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://slopable.com/tailwind.js?v=1"></script>

        <title>hd2 loadout</title>

        <meta property="og:title" content="Helldivers 2 Loadout Randomizer">
        <meta property="og:type" content="website">
        <meta property="og:description" content="created with slopable.com">
        <meta property="og:image" content="https://github.com/Faryzal2020/helldivers-2-loadout/blob/main/og-image.png">
        <meta property="og:url" content="https://faryzal2020.github.io/helldivers-2-loadout/">

        <link rel="icon" type="image/png" href="/favicon-96x96.png?v=1" sizes="96x96" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=1" />

        <style>
            button{touch-action:manipulation;}
            
            /* Custom Scrollbar */
            .custom-scrollbar::-webkit-scrollbar {
                width: 6px;
            }
            
            .custom-scrollbar::-webkit-scrollbar-track {
                background: rgba(39, 39, 42, 0.5);
                border-radius: 3px;
            }
            
            .custom-scrollbar::-webkit-scrollbar-thumb {
                background: rgba(250, 204, 21, 0.3);
                border-radius: 3px;
            }
            
            .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                background: rgba(250, 204, 21, 0.5);
            }
            
            /* Slower Scrolling */
            .custom-scrollbar {
                scroll-behavior: smooth;
                scroll-padding: 4px;
            }
            
            /* Reduce scroll speed by intercepting wheel events */
            .slow-scroll {
                scroll-behavior: smooth;
                scroll-padding: 4px;
            }
            

        </style>
    </head>
    <body>
        <div class="bg-zinc-950 text-white h-screen flex bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre-v2.png')] overflow-hidden">
            <!-- Left Customization Panel -->
            <div id="customization-panel" class="w-80 bg-black/90 backdrop-blur-sm border-r border-yellow-500/30 overflow-hidden transform -translate-x-full lg:translate-x-0 transition-transform duration-300 fixed lg:relative z-40 h-screen max-h-screen flex flex-col">
                <!-- Panel Header -->
                <div class="p-2 border-b border-yellow-500/30 bg-gradient-to-r from-yellow-900/20 to-yellow-800/20 flex-shrink-0">
                    <div class="text-center">
                        <h2 class="text-sm font-bold text-yellow-400 uppercase tracking-wider">Loadout Filter</h2>
                        <p class="text-xs text-white-400">Customize your randomization pool</p>
                    </div>
                </div>

                <!-- Scrollable Content -->
                <div class="flex-1 flex flex-col min-h-0 overflow-hidden">
                    <!-- Primary Weapons Section -->
                    <div class="filter-section flex-1 flex flex-col min-h-0">
                        <div class="filter-header bg-gradient-to-r from-yellow-900/30 to-yellow-800/30 px-2 py-0.5 border border-yellow-500/30 flex-shrink-0">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xs font-semibold text-yellow-300 uppercase tracking-wide">Primary Weapons</h3>
                                <span class="primary-count text-xs text-white-400 bg-zinc-800 px-1.5 py-0.5 rounded">0/0</span>
                            </div>
                        </div>
                        <div class="filter-content bg-zinc-900/50 border-x border-b border-yellow-500/30 p-1 flex-1 flex flex-col min-h-0">
                            <!-- Search Box -->
                            <div class="relative mb-1">
                                <input type="text" id="primary-search" placeholder="Search primary weapons..." class="w-full bg-zinc-800 border border-zinc-600 rounded px-2 py-0.5 text-xs text-white placeholder-zinc-400 focus:border-yellow-400 focus:ring-1 focus:ring-yellow-400 focus:outline-none">
                                <svg class="absolute right-2 top-1 w-3 h-3 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <!-- Select All -->
                            <label class="flex items-center space-x-2 text-xs p-0.5 bg-zinc-800/50 rounded border border-zinc-700 hover:bg-zinc-700/50 transition-colors mb-1">
                                <input type="checkbox" id="select-all-primaries" class="rounded bg-zinc-800 border-zinc-600 text-yellow-400 focus:ring-yellow-400 focus:ring-offset-0">
                                <span class="text-yellow-200 font-medium">Select All</span>
                            </label>
                            <!-- Items Container -->
                            <div id="primary-filters" class="space-y-0.5 flex-1 overflow-y-auto custom-scrollbar">
                                <!-- Primary weapon checkboxes will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Secondary Weapons Section -->
                    <div class="filter-section flex-1 flex flex-col min-h-0">
                        <div class="filter-header bg-gradient-to-r from-yellow-900/30 to-yellow-800/30 px-2 py-0.5 border border-yellow-500/30 flex-shrink-0">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xs font-semibold text-yellow-300 uppercase tracking-wide">Secondary Weapons</h3>
                                <span class="secondary-count text-xs text-white-400 bg-zinc-800 px-1.5 py-0.5 rounded">0/0</span>
                            </div>
                        </div>
                        <div class="filter-content bg-zinc-900/50 border-x border-b border-yellow-500/30 p-1 flex-1 flex flex-col min-h-0">
                            <!-- Search Box -->
                            <div class="relative mb-1">
                                <input type="text" id="secondary-search" placeholder="Search secondary weapons..." class="w-full bg-zinc-800 border border-zinc-600 rounded px-2 py-0.5 text-xs text-white placeholder-zinc-400 focus:border-yellow-400 focus:ring-1 focus:ring-yellow-400 focus:outline-none">
                                <svg class="absolute right-2 top-1 w-3 h-3 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <!-- Select All -->
                            <label class="flex items-center space-x-2 text-xs p-0.5 bg-zinc-800/50 rounded border border-zinc-700 hover:bg-zinc-700/50 transition-colors mb-1">
                                <input type="checkbox" id="select-all-secondaries" class="rounded bg-zinc-800 border-zinc-600 text-yellow-400 focus:ring-yellow-400 focus:ring-offset-0">
                                <span class="text-yellow-200 font-medium">Select All</span>
                            </label>
                            <!-- Items Container -->
                            <div id="secondary-filters" class="space-y-0.5 flex-1 overflow-y-auto custom-scrollbar">
                                <!-- Secondary weapon checkboxes will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Grenades Section -->
                    <div class="filter-section flex-1 flex flex-col min-h-0">
                        <div class="filter-header bg-gradient-to-r from-yellow-900/30 to-yellow-800/30 px-2 py-0.5 border border-yellow-500/30 flex-shrink-0">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xs font-semibold text-yellow-300 uppercase tracking-wide">Grenades</h3>
                                <span class="grenade-count text-xs text-white-400 bg-zinc-800 px-1.5 py-0.5 rounded">0/0</span>
                            </div>
                        </div>
                        <div class="filter-content bg-zinc-900/50 border-x border-b border-yellow-500/30 p-1 flex-1 flex flex-col min-h-0">
                            <!-- Search Box -->
                            <div class="relative mb-1">
                                <input type="text" id="grenade-search" placeholder="Search grenades..." class="w-full bg-zinc-800 border border-zinc-600 rounded px-2 py-0.5 text-xs text-white placeholder-zinc-400 focus:border-yellow-400 focus:ring-1 focus:ring-yellow-400 focus:outline-none">
                                <svg class="absolute right-2 top-1 w-3 h-3 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <!-- Select All -->
                            <label class="flex items-center space-x-2 text-xs p-0.5 bg-zinc-800/50 rounded border border-zinc-700 hover:bg-zinc-700/50 transition-colors mb-1">
                                <input type="checkbox" id="select-all-grenades" class="rounded bg-zinc-800 border-zinc-600 text-yellow-400 focus:ring-yellow-400 focus:ring-offset-0">
                                <span class="text-yellow-200 font-medium">Select All</span>
                            </label>
                            <!-- Items Container -->
                            <div id="grenade-filters" class="space-y-0.5 flex-1 overflow-y-auto custom-scrollbar">
                                <!-- Grenade checkboxes will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Stratagems Section -->
                    <div class="filter-section flex-1 flex flex-col min-h-0">
                        <div class="filter-header bg-gradient-to-r from-yellow-900/30 to-yellow-800/30 px-2 py-0.5 border border-yellow-500/30 flex-shrink-0">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xs font-semibold text-yellow-300 uppercase tracking-wide">Stratagems</h3>
                                <span class="stratagem-count text-xs text-white-400 bg-zinc-800 px-1.5 py-0.5 rounded">0/0</span>
                            </div>
                        </div>
                        <div class="filter-content bg-zinc-900/50 border-x border-b border-yellow-500/30 p-1 flex-1 flex flex-col min-h-0">
                            <!-- Search Box -->
                            <div class="relative mb-1">
                                <input type="text" id="stratagem-search" placeholder="Search stratagems..." class="w-full bg-zinc-800 border border-zinc-600 rounded px-2 py-0.5 text-xs text-white placeholder-zinc-400 focus:border-yellow-400 focus:ring-1 focus:ring-yellow-400 focus:outline-none">
                                <svg class="absolute right-2 top-1 w-3 h-3 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <!-- Select All -->
                            <label class="flex items-center space-x-2 text-xs p-0.5 bg-zinc-800/50 rounded border border-zinc-700 hover:bg-zinc-700/50 transition-colors mb-1">
                                <input type="checkbox" id="select-all-stratagems" class="rounded bg-zinc-800 border-zinc-600 text-yellow-400 focus:ring-yellow-400 focus:ring-offset-0">
                                <span class="text-yellow-200 font-medium">Select All</span>
                            </label>
                            <!-- Items Container -->
                            <div id="stratagem-filters" class="space-y-0.5 flex-1 overflow-y-auto custom-scrollbar">
                                <!-- Stratagem checkboxes will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Panel Footer -->
                <div class="p-1.5 border-t border-yellow-500/30 bg-gradient-to-r from-yellow-900/20 to-yellow-800/20 flex-shrink-0 space-y-1.5">
                    <!-- Selective Rolling Option -->
                    <div class="bg-zinc-800/50 border border-yellow-500/30 rounded p-1.5">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="selective-rolling" class="rounded bg-zinc-800 border-zinc-600 text-yellow-400 focus:ring-yellow-400 focus:ring-offset-0">
                            <div class="flex-1">
                                <span class="text-yellow-300 font-semibold text-xs">Selective Rolling</span>
                                <p class="text-xs text-zinc-400 leading-tight">Each slot picks from different category</p>
                            </div>
                        </label>
                    </div>
                    
                    <button id="reset-filters" class="w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-bold py-1 px-2 rounded transition-all duration-200 transform hover:scale-105 active:scale-95 shadow-lg">
                        <div class="flex items-center justify-center space-x-1">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            <span class="text-xs">Reset All Filters</span>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Panel Toggle Button (Mobile) -->
            <button id="panel-toggle" class="fixed top-4 left-4 lg:hidden z-50 bg-yellow-400 text-zinc-900 p-2 rounded-lg shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
            </button>

            <!-- Main Content -->
            <div class="flex-1 flex flex-col h-full overflow-hidden">
                <!-- Header Section -->
                <div class="flex-shrink-0 text-center py-4 px-4">
                    <h1 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-extrabold text-yellow-400 uppercase tracking-wider mb-2" style="text-shadow: 0 0 5px #facc15, 0 0 10px #facc15, 0 0 20px #000, 0 0 30px #000;">Loadout Roulette</h1>
                    <p class="text-zinc-400 text-xs sm:text-sm">Super Earth Command has randomized your next drop. Make us proud.</p>
                </div>

                <!-- Loadout Display -->
                <div class="flex-1 flex flex-col justify-center px-4 py-2 overflow-hidden">
                    <div id="loadout-display" class="w-full max-w-6xl mx-auto space-y-4">
                        <!-- Weapons & Grenade -->
                        <div>
                            <h2 class="text-lg sm:text-xl font-bold text-yellow-300 mb-3 border-b-2 border-yellow-500/50 pb-1 uppercase tracking-widest">Armament</h2>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4">
                                <!-- Primary -->
                                <div id="primary-card" class="loadout-card bg-black/50 border-2 border-zinc-700 rounded-lg p-3 flex flex-col items-center justify-between transition-all duration-300 min-h-[180px] sm:min-h-[200px] backdrop-blur-sm">
                                    <div class="flex-grow flex items-center justify-center w-full">
                                        <img id="primary-img" src="https://raw.githubusercontent.com/Faryzal2020/helldivers-2-database/main/icons/helldivers-2-logo.webp" alt="Primary Weapon" class="max-h-20 sm:max-h-24 object-contain filter grayscale transition-all duration-300">
                                    </div>
                                    <div class="h-12 flex flex-col items-center justify-center text-center">
                                         <p id="primary-name" class="text-sm sm:text-base font-semibold text-zinc-400 transition-colors duration-300">PRIMARY WEAPON</p>
                                    </div>
                                </div>
                                <!-- Secondary -->
                                <div id="secondary-card" class="loadout-card bg-black/50 border-2 border-zinc-700 rounded-lg p-3 flex flex-col items-center justify-between transition-all duration-300 min-h-[180px] sm:min-h-[200px] backdrop-blur-sm">
                                    <div class="flex-grow flex items-center justify-center w-full">
                                        <img id="secondary-img" src="https://raw.githubusercontent.com/Faryzal2020/helldivers-2-database/main/icons/helldivers-2-logo.webp" alt="Secondary Weapon" class="max-h-20 sm:max-h-24 object-contain filter grayscale transition-all duration-300">
                                    </div>
                                     <div class="h-12 flex flex-col items-center justify-center text-center">
                                         <p id="secondary-name" class="text-sm sm:text-base font-semibold text-zinc-400 transition-colors duration-300">SECONDARY WEAPON</p>
                                    </div>
                                </div>
                                <!-- Grenade -->
                                <div id="grenade-card" class="loadout-card bg-black/50 border-2 border-zinc-700 rounded-lg p-3 flex flex-col items-center justify-between transition-all duration-300 min-h-[180px] sm:min-h-[200px] backdrop-blur-sm">
                                    <div class="flex-grow flex items-center justify-center w-full">
                                        <img id="grenade-img" src="https://raw.githubusercontent.com/Faryzal2020/helldivers-2-database/main/icons/helldivers-2-logo.webp" alt="Grenade" class="max-h-20 sm:max-h-24 object-contain filter grayscale transition-all duration-300">
                                    </div>
                                     <div class="h-12 flex flex-col items-center justify-center text-center">
                                         <p id="grenade-name" class="text-sm sm:text-base font-semibold text-zinc-400 transition-colors duration-300">GRENADE</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Stratagems -->
                        <div>
                            <h2 class="text-lg sm:text-xl font-bold text-yellow-300 mb-3 border-b-2 border-yellow-500/50 pb-1 uppercase tracking-widest">Stratagems</h2>
                            <div id="stratagem-grid" class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
                                <!-- Stratagem slots -->
                                <div id="stratagem-card-0" class="loadout-card bg-black/50 border-2 border-zinc-700 rounded-lg p-3 flex flex-col items-center justify-between transition-all duration-300 min-h-[180px] sm:min-h-[200px] backdrop-blur-sm">
                                     <div class="flex-grow flex items-center justify-center w-full">
                                        <img id="stratagem-img-0" src="https://raw.githubusercontent.com/Faryzal2020/helldivers-2-database/main/icons/helldivers-2-logo.webp" alt="Stratagem 1" class="max-h-20 sm:max-h-24 object-contain filter grayscale transition-all duration-300">
                                    </div>
                                     <div class="h-12 flex flex-col items-center justify-center text-center">
                                         <p id="stratagem-category-0" class="text-xs text-yellow-400 font-medium mb-1 hidden">OFFENSIVE</p>
                                         <p id="stratagem-name-0" class="text-xs sm:text-sm font-semibold text-zinc-400 transition-colors duration-300">STRATAGEM</p>
                                    </div>
                                </div>
                                 <div id="stratagem-card-1" class="loadout-card bg-black/50 border-2 border-zinc-700 rounded-lg p-3 flex flex-col items-center justify-between transition-all duration-300 min-h-[180px] sm:min-h-[200px] backdrop-blur-sm">
                                     <div class="flex-grow flex items-center justify-center w-full">
                                        <img id="stratagem-img-1" src="https://raw.githubusercontent.com/Faryzal2020/helldivers-2-database/main/icons/helldivers-2-logo.webp" alt="Stratagem 2" class="max-h-20 sm:max-h-24 object-contain filter grayscale transition-all duration-300">
                                    </div>
                                     <div class="h-12 flex flex-col items-center justify-center text-center">
                                         <p id="stratagem-category-1" class="text-xs text-blue-400 font-medium mb-1 hidden">DEFENSIVE</p>
                                         <p id="stratagem-name-1" class="text-xs sm:text-sm font-semibold text-zinc-400 transition-colors duration-300">STRATAGEM</p>
                                    </div>
                                </div>
                                 <div id="stratagem-card-2" class="loadout-card bg-black/50 border-2 border-zinc-700 rounded-lg p-3 flex flex-col items-center justify-between transition-all duration-300 min-h-[180px] sm:min-h-[200px] backdrop-blur-sm">
                                     <div class="flex-grow flex items-center justify-center w-full">
                                        <img id="stratagem-img-2" src="https://raw.githubusercontent.com/Faryzal2020/helldivers-2-database/main/icons/helldivers-2-logo.webp" alt="Stratagem 3" class="max-h-20 sm:max-h-24 object-contain filter grayscale transition-all duration-300">
                                    </div>
                                     <div class="h-12 flex flex-col items-center justify-center text-center">
                                         <p id="stratagem-category-2" class="text-xs text-green-400 font-medium mb-1 hidden">SUPPORT</p>
                                         <p id="stratagem-name-2" class="text-xs sm:text-sm font-semibold text-zinc-400 transition-colors duration-300">STRATAGEM</p>
                                    </div>
                                </div>
                                 <div id="stratagem-card-3" class="loadout-card bg-black/50 border-2 border-zinc-700 rounded-lg p-3 flex flex-col items-center justify-between transition-all duration-300 min-h-[180px] sm:min-h-[200px] backdrop-blur-sm">
                                     <div class="flex-grow flex items-center justify-center w-full">
                                        <img id="stratagem-img-3" src="https://raw.githubusercontent.com/Faryzal2020/helldivers-2-database/main/icons/helldivers-2-logo.webp" alt="Stratagem 4" class="max-h-20 sm:max-h-24 object-contain filter grayscale transition-all duration-300">
                                    </div>
                                     <div class="h-12 flex flex-col items-center justify-center text-center">
                                         <p id="stratagem-category-3" class="text-xs text-purple-400 font-medium mb-1 hidden">UTILITY</p>
                                         <p id="stratagem-name-3" class="text-xs sm:text-sm font-semibold text-zinc-400 transition-colors duration-300">STRATAGEM</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Deploy Button -->
                <div class="flex-shrink-0 text-center py-4 px-4">
                    <button id="roll-button" class="touch-manipulation bg-yellow-400 text-zinc-900 text-lg sm:text-xl md:text-2xl font-black py-3 px-8 rounded-lg shadow-lg shadow-yellow-400/30 hover:bg-yellow-300 hover:scale-105 active:scale-95 transition-all duration-200 disabled:bg-zinc-700 disabled:text-zinc-400 disabled:cursor-not-allowed disabled:scale-100 disabled:shadow-none uppercase tracking-widest">
                        LOADING DATA...
                    </button>
                </div>
                
                <audio id="deploy-sound" src="https://www.myinstants.com/media/sounds/deploy.mp3" preload="auto"></audio>
                <audio id="success-sound" src="https://www.myinstants.com/media/sounds/mission-completed-hd2.mp3" preload="auto"></audio>
            </div>
        </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const rollButton = document.getElementById('roll-button');
    const panelToggle = document.getElementById('panel-toggle');
    const customizationPanel = document.getElementById('customization-panel');
    
    const cardElements = {
        primary: {
            img: document.getElementById('primary-img'),
            name: document.getElementById('primary-name'),
            card: document.getElementById('primary-card'),
        },
        secondary: {
            img: document.getElementById('secondary-img'),
            name: document.getElementById('secondary-name'),
            card: document.getElementById('secondary-card'),
        },
        grenade: {
            img: document.getElementById('grenade-img'),
            name: document.getElementById('grenade-name'),
            card: document.getElementById('grenade-card'),
        },
        stratagems: Array.from({ length: 4 }, (_, i) => ({
            img: document.getElementById(`stratagem-img-${i}`),
            name: document.getElementById(`stratagem-name-${i}`),
            card: document.getElementById(`stratagem-card-${i}`),
            category: document.getElementById(`stratagem-category-${i}`),
        }))
    };

    const deploySound = document.getElementById('deploy-sound');
    const successSound = document.getElementById('success-sound');

    const BASE_URL = 'https://raw.githubusercontent.com/Faryzal2020/helldivers-2-database/main/';
    const DATA_PATHS = {
        primaries: 'data/weapons/primary.json',
        secondaries: 'data/weapons/secondary.json',
        grenades: 'data/weapons/grenades.json',
        stratagems: 'data/stratagems/list.json'
    };

    let data = { primaries: [], secondaries: [], grenades: [], stratagems: [] };
    let filteredData = { primaries: [], secondaries: [], grenades: [], stratagems: [] };
    let stratagemCategories = { offensive: [], defensive: [], support: [], utility: [] };
    let isRolling = false;

    // Panel toggle functionality
    panelToggle.addEventListener('click', () => {
        customizationPanel.classList.toggle('-translate-x-full');
    });

    // Selective rolling toggle functionality
    const selectiveRollingCheckbox = document.getElementById('selective-rolling');
    selectiveRollingCheckbox.addEventListener('change', (e) => {
        const categoryLabels = document.querySelectorAll('[id^="stratagem-category-"]');
        categoryLabels.forEach(label => {
            if (e.target.checked) {
                label.classList.remove('hidden');
            } else {
                label.classList.add('hidden');
            }
        });
    });

    // Close panel when clicking outside on mobile
    document.addEventListener('click', (e) => {
        if (window.innerWidth < 1024 && 
            !customizationPanel.contains(e.target) && 
            !panelToggle.contains(e.target) &&
            !customizationPanel.classList.contains('-translate-x-full')) {
            customizationPanel.classList.add('-translate-x-full');
        }
    });



    // Search functionality
    function setupSearch(searchId, containerId, category) {
        const searchInput = document.getElementById(searchId);
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const container = document.getElementById(containerId);
            const items = container.querySelectorAll('label');
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    }

    // Update counters
    function updateCounters() {
        const categories = [
            { key: 'primaries', className: 'primary-count' },
            { key: 'secondaries', className: 'secondary-count' },
            { key: 'grenades', className: 'grenade-count' },
            { key: 'stratagems', className: 'stratagem-count' }
        ];
        
        categories.forEach(category => {
            const checkboxes = document.querySelectorAll(`input[data-category="${category.key}"]`);
            const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            const totalCount = checkboxes.length;
            
            const counterElement = document.querySelector(`.${category.className}`);
            if (counterElement) {
                counterElement.textContent = `${checkedCount}/${totalCount}`;
                
                // Color coding
                if (checkedCount === 0) {
                    counterElement.className = counterElement.className.replace(/bg-\w+-\d+/, 'bg-red-600');
                } else if (checkedCount === totalCount) {
                    counterElement.className = counterElement.className.replace(/bg-\w+-\d+/, 'bg-green-600');
                } else {
                    counterElement.className = counterElement.className.replace(/bg-\w+-\d+/, 'bg-yellow-600');
                }
            }
        });
    }

    async function loadData() {
        try {
            const responses = await Promise.all([
                fetch(BASE_URL + DATA_PATHS.primaries),
                fetch(BASE_URL + DATA_PATHS.secondaries),
                fetch(BASE_URL + DATA_PATHS.grenades),
                fetch(BASE_URL + DATA_PATHS.stratagems)
            ]);

            for (const res of responses) {
                if (!res.ok) throw new Error(`Failed to fetch ${res.url}`);
            }

            const [primaryData, secondaryData, grenadeData, stratagemData] = await Promise.all(responses.map(res => res.json()));
            
            data.primaries = primaryData;
            data.secondaries = secondaryData;
            data.grenades = grenadeData;
            
            // Process stratagems and add category information
            data.stratagems = [];
            Object.keys(stratagemData).forEach(category => {
                stratagemData[category].forEach(stratagem => {
                    data.stratagems.push({
                        ...stratagem,
                        category: category
                    });
                });
            });
            
            // Store stratagem categories separately
            stratagemCategories = {
                offensive: stratagemData.offensive || [],
                defensive: stratagemData.defensive || [],
                support: stratagemData.support || [],
                utility: stratagemData.utility || []
            };
            
            // Initialize filtered data with all items
            filteredData = {
                primaries: [...data.primaries],
                secondaries: [...data.secondaries],
                grenades: [...data.grenades],
                stratagems: [...data.stratagems]
            };
            
            populateFilters();
            rollButton.disabled = false;
            rollButton.textContent = 'DEPLOY!';
        } catch (error) {
            console.error('Failed to load Helldivers data:', error);
            rollButton.textContent = 'DATA ERROR';
            rollButton.classList.add('!bg-red-600', '!text-white');
        }
    }

    function populateFilters() {
        populateFilterSection('primary-filters', 'select-all-primaries', data.primaries, 'primaries');
        populateFilterSection('secondary-filters', 'select-all-secondaries', data.secondaries, 'secondaries');
        populateFilterSection('grenade-filters', 'select-all-grenades', data.grenades, 'grenades');
        populateFilterSection('stratagem-filters', 'select-all-stratagems', data.stratagems, 'stratagems');
        
        // Setup search functionality
        setupSearch('primary-search', 'primary-filters', 'primaries');
        setupSearch('secondary-search', 'secondary-filters', 'secondaries');
        setupSearch('grenade-search', 'grenade-filters', 'grenades');
        setupSearch('stratagem-search', 'stratagem-filters', 'stratagems');
        
        // Update initial counters
        updateCounters();
    }

    function populateFilterSection(containerId, selectAllId, items, dataKey) {
        const container = document.getElementById(containerId);
        const selectAllCheckbox = document.getElementById(selectAllId);
        
        // Clear existing content
        container.innerHTML = '';
        
        // Sort stratagems by category if this is the stratagem section
        let sortedItems = [...items];
        if (dataKey === 'stratagems') {
            const categoryOrder = { 'offensive': 0, 'support': 1, 'utility': 2, 'defensive': 3 };
            sortedItems.sort((a, b) => {
                const aCat = a.category || 'unknown';
                const bCat = b.category || 'unknown';
                const aOrder = categoryOrder[aCat] !== undefined ? categoryOrder[aCat] : 4;
                const bOrder = categoryOrder[bCat] !== undefined ? categoryOrder[bCat] : 4;
                
                if (aOrder !== bOrder) {
                    return aOrder - bOrder;
                }
                return a.name.localeCompare(b.name);
            });
        }
        
        // Create checkboxes for each item
        sortedItems.forEach((item, index) => {
            const originalIndex = items.indexOf(item);
            
            const label = document.createElement('label');
            label.className = 'flex items-center space-x-2 text-xs p-1 bg-zinc-800/30 rounded border border-zinc-700/50 hover:bg-zinc-700/50 transition-colors cursor-pointer';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.checked = true;
            checkbox.className = 'rounded bg-zinc-800 border-zinc-600 text-yellow-400 focus:ring-yellow-400 focus:ring-offset-0 w-3 h-3 flex-shrink-0';
            checkbox.dataset.category = dataKey;
            checkbox.dataset.index = originalIndex;
            
            // Add icon for stratagems
            if (dataKey === 'stratagems' && item.icon) {
                const img = document.createElement('img');
                img.src = BASE_URL + item.icon;
                img.alt = item.name;
                img.className = 'w-4 h-4 object-contain flex-shrink-0';
                img.onerror = function() {
                    this.style.display = 'none';
                };
                label.appendChild(checkbox);
                label.appendChild(img);
            } else {
                label.appendChild(checkbox);
            }
            
            const span = document.createElement('span');
            span.textContent = item.name;
            span.className = 'text-zinc-300 flex-1 text-xs leading-tight';
            
            // Add category badge for stratagems
            if (dataKey === 'stratagems' && item.category) {
                const categoryBadge = document.createElement('span');
                categoryBadge.textContent = item.category.charAt(0).toUpperCase() + item.category.slice(1);
                categoryBadge.className = `text-xs px-1.5 py-0.5 rounded text-white font-medium ml-1 flex-shrink-0 ${getCategoryColor(item.category)}`;
                
                const textContainer = document.createElement('div');
                textContainer.className = 'flex items-center justify-between flex-1 min-w-0';
                textContainer.appendChild(span);
                textContainer.appendChild(categoryBadge);
                label.appendChild(textContainer);
            } else {
                label.appendChild(span);
            }
            
            container.appendChild(label);
            
            // Add event listener for individual checkboxes
            checkbox.addEventListener('change', () => {
                updateFilteredData();
                updateCounters();
            });
        });
        
        // Set up select all functionality
        selectAllCheckbox.checked = true;
        selectAllCheckbox.addEventListener('change', (e) => {
            const checkboxes = container.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = e.target.checked);
            updateFilteredData();
            updateCounters();
        });
    }
    
    function getCategoryColor(category) {
        const colors = {
            'offensive': 'bg-yellow-600',
            'defensive': 'bg-blue-600',
            'support': 'bg-green-600',
            'utility': 'bg-purple-600'
        };
        return colors[category] || 'bg-gray-600';
    }

    function updateFilteredData() {
        // Update filtered data based on checked items
        ['primaries', 'secondaries', 'grenades', 'stratagems'].forEach(category => {
            const checkboxes = document.querySelectorAll(`input[data-category="${category}"]`);
            filteredData[category] = [];
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    const index = parseInt(checkbox.dataset.index);
                    filteredData[category].push(data[category][index]);
                }
            });
        });
    }

    // Reset filters functionality
    document.getElementById('reset-filters').addEventListener('click', () => {
        const allCheckboxes = document.querySelectorAll('#customization-panel input[type="checkbox"]');
        allCheckboxes.forEach(cb => cb.checked = true);
        
        // Clear all search inputs
        document.querySelectorAll('#customization-panel input[type="text"]').forEach(input => {
            input.value = '';
            // Trigger input event to show all items
            input.dispatchEvent(new Event('input'));
        });
        
        updateFilteredData();
        updateCounters();
    });
    
    const getRandomItem = (arr) => arr[Math.floor(Math.random() * arr.length)];
    
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    const getUniqueStratagems = (count) => shuffleArray([...filteredData.stratagems]).slice(0, count);
    
    const getSelectiveStratagems = () => {
        const categories = ['offensive', 'defensive', 'support', 'utility'];
        const selectedStratagems = [];
        
        categories.forEach(category => {
            const categoryItems = stratagemCategories[category];
            if (categoryItems && categoryItems.length > 0) {
                selectedStratagems.push(getRandomItem(categoryItems));
            }
        });
        
        // If we don't have enough categories, fill remaining with random stratagems
        while (selectedStratagems.length < 4) {
            const randomStratagem = getRandomItem(filteredData.stratagems);
            if (!selectedStratagems.some(s => s.name === randomStratagem.name)) {
                selectedStratagems.push(randomStratagem);
            }
        }
        
        return selectedStratagems.slice(0, 4);
    };
    
    const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));
    
    const playSound = (audioElement) => {
        audioElement.currentTime = 0;
        audioElement.play().catch(e => console.warn("Sound play failed. User interaction might be needed.", e));
    }

    async function animateRoll(card, dataArray, finalItem, duration = 1500) {
        const interval = 60;
        const steps = duration / interval;
        
        card.card.classList.add('border-yellow-400/50', 'animate-pulse');
        card.img.classList.add('blur-sm', 'scale-90');
        
        for (let i = 0; i < steps; i++) {
            const randomItem = getRandomItem(dataArray);
            card.img.src = BASE_URL + randomItem.icon;
            if(i > steps - 5) card.name.textContent = randomItem.name.toUpperCase();
            await sleep(interval);
        }
        
        card.img.src = BASE_URL + finalItem.icon;
        card.name.textContent = finalItem.name.toUpperCase();
        card.card.classList.remove('border-yellow-400/50', 'animate-pulse', 'border-zinc-700');
        card.card.classList.add('border-yellow-400');
        card.img.classList.remove('filter', 'grayscale', 'blur-sm', 'scale-90');
        card.name.classList.remove('text-zinc-400');
        card.name.classList.add('text-white');
    }

    function resetCards() {
        const allCards = [cardElements.primary, cardElements.secondary, cardElements.grenade, ...cardElements.stratagems];
        allCards.forEach(({ card, img, name, category }) => {
            card.classList.remove('border-yellow-400');
            card.classList.add('border-zinc-700');
            img.classList.add('filter', 'grayscale');
            name.classList.remove('text-white');
            name.classList.add('text-zinc-400');
            
            // Reset category labels for stratagems
            if (category) {
                const selectiveRollingEnabled = document.getElementById('selective-rolling').checked;
                if (selectiveRollingEnabled) {
                    category.classList.remove('hidden');
                } else {
                    category.classList.add('hidden');
                }
            }
        });
    }

    async function handleRoll() {
        if (isRolling || filteredData.primaries.length === 0) return;
        
        // Check if any category is empty
        const selectiveRollingEnabled = document.getElementById('selective-rolling').checked;
        
        if (filteredData.primaries.length === 0 || 
            filteredData.secondaries.length === 0 || 
            filteredData.grenades.length === 0) {
            alert('Please select at least one item from each weapon category!');
            return;
        }
        
        if (selectiveRollingEnabled) {
            // Check if we have at least one stratagem in each category
            const missingCategories = [];
            if (stratagemCategories.offensive.length === 0) missingCategories.push('Offensive');
            if (stratagemCategories.defensive.length === 0) missingCategories.push('Defensive');
            if (stratagemCategories.support.length === 0) missingCategories.push('Support');
            if (stratagemCategories.utility.length === 0) missingCategories.push('Utility');
            
            if (missingCategories.length > 0) {
                alert(`Selective rolling requires at least one stratagem in each category. Missing: ${missingCategories.join(', ')}`);
                return;
            }
        } else {
            if (filteredData.stratagems.length < 4) {
                alert('Please select at least 4 stratagems!');
                return;
            }
        }
        
        isRolling = true;
        rollButton.disabled = true;
        rollButton.textContent = 'DEPLOYING...';
        
        playSound(deploySound);
        resetCards();
        await sleep(100);
        
        const selections = {
            primary: getRandomItem(filteredData.primaries),
            secondary: getRandomItem(filteredData.secondaries),
            grenade: getRandomItem(filteredData.grenades),
            stratagems: selectiveRollingEnabled ? getSelectiveStratagems() : getUniqueStratagems(4)
        };
        
        const animations = [
            animateRoll(cardElements.primary, filteredData.primaries, selections.primary, 1500),
            animateRoll(cardElements.secondary, filteredData.secondaries, selections.secondary, 1700),
            animateRoll(cardElements.grenade, filteredData.grenades, selections.grenade, 1900),
            ...selections.stratagems.map((strat, i) => 
                animateRoll(cardElements.stratagems[i], filteredData.stratagems, strat, 2100 + i * 200)
            )
        ];

        await Promise.all(animations);
        
        playSound(successSound);

        isRolling = false;
        rollButton.disabled = false;
        rollButton.textContent = 'GO AGAIN, DIVER!';
    }
    
    // Slower scrolling for filter lists
    function addSlowScrolling() {
        const scrollContainers = document.querySelectorAll('.custom-scrollbar');
        
        scrollContainers.forEach(container => {
            let isScrolling = false;
            
            container.addEventListener('wheel', function(e) {
                e.preventDefault();
                
                if (!isScrolling) {
                    isScrolling = true;
                    
                    // Reduce scroll speed by dividing the delta
                    const scrollAmount = e.deltaY * 0.3; // Adjust this value to make it slower/faster
                    
                    // Smooth scroll animation
                    const startTime = performance.now();
                    const startScrollTop = container.scrollTop;
                    const targetScrollTop = Math.max(0, Math.min(
                        container.scrollHeight - container.clientHeight,
                        startScrollTop + scrollAmount
                    ));
                    
                    function animateScroll(currentTime) {
                        const elapsed = currentTime - startTime;
                        const duration = 150; // Animation duration in ms
                        
                        if (elapsed < duration) {
                            const progress = elapsed / duration;
                            // Easing function for smooth animation
                            const easeProgress = 1 - Math.pow(1 - progress, 3);
                            
                            container.scrollTop = startScrollTop + (targetScrollTop - startScrollTop) * easeProgress;
                            requestAnimationFrame(animateScroll);
                        } else {
                            container.scrollTop = targetScrollTop;
                            isScrolling = false;
                        }
                    }
                    
                    requestAnimationFrame(animateScroll);
                }
            }, { passive: false });
        });
    }
    
    // Initialize slow scrolling after data is loaded
    const originalLoadData = loadData;
    loadData = async function() {
        await originalLoadData();
        // Add slow scrolling after the filter containers are populated
        setTimeout(addSlowScrolling, 100);
    };

    rollButton.addEventListener('click', handleRoll);
    rollButton.disabled = true;
    loadData();
});
</script>
        
        <!-- Bottom right banners container -->
        <div id="bannerContainer" class="fixed bottom-5 right-5 max-sm:bottom-3 max-sm:right-3 flex flex-col gap-2.5 z-50 items-end">
            <!-- Share and copy links banner -->
            <div class="bg-white/90 shadow-md rounded-lg px-3 py-2 flex justify-between items-center gap-2 relative">
                <!-- Close button -->
                <button id="closeBannerButton" class="absolute -top-3.5 -left-3.5 bg-white shadow-md rounded-full p-1 text-gray-500 hover:text-gray-700 focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                    </svg>
                </button>

                                <button id="shareButton" class="flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 text-blue-600">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z" />
                    </svg>
                    <span class="font-medium text-xs text-gray-700 hover:text-gray-900 sm:text-lg">share</span>
                </button>
                <div class="h-4 w-px bg-gray-300"></div>
                <button id="copyButton" class="flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 text-green-600">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.123-.08M15.75 18H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08M15.75 18.75v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5A3.375 3.375 0 0 0 6.375 7.5H5.25m11.9-3.664A2.251 2.251 0 0 0 15 2.25h-1.5a2.251 2.251 0 0 0-2.15 1.586m5.8 0c.065.21.1.433.1.664v.75h-6V4.5c0-.231.035-.454.1-.664M6.75 7.5H4.875c-.621 0-1.125.504-1.125 1.125v12c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V16.5a9 9 0 0 0-9-9Z" />
                    </svg>
                    <span class="font-medium text-xs text-gray-700 hover:text-gray-900 sm:text-lg">copy link</span>
                </button>
            </div>

            <!-- Original banner with slopable credit -->
            <div class="bg-white/90 shadow-md rounded-lg px-3 py-2">
                <div class="flex gap-1 items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5 text-red-600">
                            <path d="m9.653 16.915-.005-.003-.019-.01a20.759 20.759 0 0 1-1.162-.682 22.045 22.045 0 0 1-2.582-1.9C4.045 12.733 2 10.352 2 7.5a4.5 4.5 0 0 1 8-2.828A4.5 4.5 0 0 1 18 7.5c0 2.852-2.044 5.233-3.885 6.82a22.049 22.049 0 0 1-3.744 2.582l-.019.01-.005.003h-.002a.739.739 0 0 1-.69.001l-.002-.001Z" />
                        </svg>
                        <p class="text-xs text-gray-700 font-medium sm:text-lg">
                            created with <a href="https://slopable.com" class="text-blue-600 hover:underline">slopable.com</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <script>
            const url = 'https://faryzal2020.github.io/helldivers-2-loadout/';

            
            // Share and copy functionality
            const bannerContainer = document.getElementById('bannerContainer');
            const closeBannerButton = document.getElementById('closeBannerButton');
            const shareButton = document.getElementById('shareButton');
            const copyButton = document.getElementById('copyButton');

            // Close banner functionality
            if (closeBannerButton && bannerContainer) {
                closeBannerButton.addEventListener('click', () => {
                    bannerContainer.style.display = 'none';
                });
            }

            // Share functionality
            if (shareButton) {
                shareButton.addEventListener('click', async () => {
                    try {
                        if (navigator.share) {
                            await navigator.share({
                                title: document.title,
                                url: url
                            });
                        } else {
                            navigator.clipboard.writeText(url);
                            alert('Tautan sudah disalin ke clipboard');
                        }
                    } catch (error) {
                        console.error('Error sharing:', error);
                    }
                });
            }

            // Copy link functionality
            if (copyButton) {
                copyButton.addEventListener('click', () => {
                    navigator.clipboard.writeText(url);

                    // Show copied feedback
                    const originalText = copyButton.querySelector('span').textContent;
                    copyButton.querySelector('span').classList.add('!text-green-600');

                    setTimeout(() => {
                        copyButton.querySelector('span').classList.remove('!text-green-600');
                    }, 700);
                });
            }
        </script>
    </body>
</html>
